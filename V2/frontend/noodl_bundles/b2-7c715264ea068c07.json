[{"name":"/Neodoctor","nodes":[{"id":"cd801fc8-9f10-a6e2-4724-7e6faa0a25bc","type":"Page","parameters":{},"ports":[],"children":[{"id":"d85739db-6e32-bb7d-d50f-6877bb2140cc","type":"Group","parameters":{"minHeight":{"value":70,"unit":"vh"},"justifyContent":"flex-start"},"ports":[],"children":[{"id":"9c271320-dfc6-0dcc-de8c-999905c2aeeb","type":"For Each","parameters":{"template":"/Neodoctor/Chat message"},"ports":[],"children":[]}]},{"id":"e27e7853-9d6e-3a29-4d2f-b90bd7cf6361","type":"Group","parameters":{"minHeight":{"value":20,"unit":"vh"},"justifyContent":"center"},"ports":[],"children":[{"id":"cc347e5a-dd5a-dd00-7896-ce5301e4e7ef","type":"Group","parameters":{"flexDirection":"row","scrollEnabled":true,"sizeMode":"contentHeight","clip":false,"nativeScroll":false,"scrollSnapEnabled":true,"width":{"value":300,"unit":"px"},"showScrollbar":false,"scrollSnapToEveryItem":false,"scrollBounceEnabled":true,"alignX":"center"},"ports":[],"children":[{"id":"6f255319-287e-109e-0dc2-6978cafa0e3f","type":"net.noodl.controls.textinput","parameters":{"sizeMode":"explicit","width":{"value":100,"unit":"%","isFixed":false},"height":{"value":100,"unit":"px"}},"ports":[],"children":[]},{"id":"2598754f-8bf9-932c-02b3-a922be43e025","type":"net.noodl.controls.button","parameters":{},"ports":[],"children":[]}]}]},{"id":"649d8c41-3205-f2a0-5ede-21fa132600c1","type":"Group","parameters":{"minHeight":{"value":10,"unit":"vh"}},"ports":[],"children":[{"id":"11221964-a080-0916-27bd-ba9b627c6fc2","type":"/Visual Components/Navigation","parameters":{},"ports":[],"children":[]}]}]},{"id":"ab61c9f9-9bf3-3dc0-0fbf-13c19940d6c0","type":"PageInputs","parameters":{},"ports":[],"children":[]},{"id":"22cebbed-ad51-efd9-b4fd-c19647f1668d","type":"Collection2","parameters":{"collectionId":"Chat_neodoctor"},"ports":[],"children":[]},{"id":"7d83f801-da7e-5a96-138d-3e2aea5c8f04","type":"JavaScriptFunction","parameters":{"functionScript":"\r\nconst id = Inputs.id\r\nconst nom = Inputs.data[0].nom\r\nconst email = Inputs.data[0].email\r\nconst age = Inputs.data[0].age\r\nconst message = Inputs.message\r\nconst output = \r\n[\r\n  {\r\n    \"id\": id,\r\n    \"nom\": nom,\r\n    \"email\": email,\r\n    \"age\": age,\r\n    \"message\": message\r\n  }\r\n]\r\n;\r\n\r\nOutputs.Response = output;"},"ports":[{"name":"in-id","displayName":"id","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-message","displayName":"message","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-data","displayName":"data","plug":"input","type":"*","group":"Inputs","index":6},{"name":"out-Response","displayName":"Response","plug":"output","type":"*","group":"Outputs","index":7}],"children":[]},{"id":"e090976d-0067-3293-ea36-256c24003375","type":"CollectionNew","parameters":{},"ports":[],"children":[]},{"id":"17514d1e-fc78-5481-6e75-3a7ad53c477a","type":"JavaScriptFunction","parameters":{"functionScript":"/**\r\n * @role Envoie une requête POST au webhook n8n spécifié et corrige la sortie pour ne retourner qu'une string si possible.\r\n * @param {object} Inputs.Data - Données à envoyer dans le body (JSON).\r\n */\r\nconst data = Inputs.Data;\r\nif (!data) {\r\n    Outputs.Failure(\"Aucune donnée à envoyer (Inputs.Data manquant)\");\r\n    return;\r\n}\r\n\r\nconst WEBHOOK_URL = \"https://n8n-dev.neosenior.fr/webhook/3d7d3cee-9217-45be-9c07-11d4fa17a37a\";\r\n\r\n(async () => {\r\n    try {\r\n        const response = await fetch(WEBHOOK_URL, {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify(data)\r\n        });\r\n\r\n        if (!response.ok) {\r\n            Outputs.Failure(`Erreur HTTP ${response.status}`);\r\n            return;\r\n        }\r\n\r\n        // On tente de lire la réponse JSON, sinon texte brut\r\n        let result;\r\n        try {\r\n            result = await response.json();\r\n        } catch {\r\n            result = await response.text();\r\n        }\r\n\r\n        // Correction : extraire la string finale si la structure est imbriquée\r\n        let text;\r\n        if (typeof result === \"string\") {\r\n            text = result;\r\n        } else if (result && typeof result.output === \"string\") {\r\n            text = result.output;\r\n        } else if (\r\n            result &&\r\n            typeof result.output === \"object\" &&\r\n            typeof result.output.output === \"string\"\r\n        ) {\r\n            text = result.output.output;\r\n        } else {\r\n            text = \"\"; // ou éventuellement Outputs.Failure(\"Sortie inattendue\")\r\n        }\r\n\r\n        Outputs.Response = text;\r\n        Outputs.Success();\r\n    } catch (err) {\r\n        Outputs.Failure(\"Erreur lors de l'appel au webhook : \" + err.message);\r\n    }\r\n})();\r\n"},"ports":[{"name":"in-Data","displayName":"Data","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"*","group":"Outputs","index":6},{"name":"out-Response","displayName":"Response","plug":"output","type":"*","group":"Outputs","index":7}],"children":[]},{"id":"80488006-914a-87c4-3c45-2ca50a317d10","type":"CollectionInsert","parameters":{},"ports":[],"children":[]},{"id":"8b788aa8-b134-5b5d-619e-78a2698836e7","type":"NewModel","parameters":{"properties":"message_user,from","type-message_user":"string","type-from":"string","prop-from":"user"},"ports":[],"children":[]},{"id":"062dc9e0-0a95-60aa-8971-245f4b5e2dbe","type":"Collection2","parameters":{"collectionId":"Chat_message_user_info","items":"\r\n[\r\n  {\r\n    \"nom\": \"john\",\r\n    \"email\": \"dupont@example.com\",\r\n    \"age\": 32\r\n  }\r\n]"},"ports":[],"children":[]},{"id":"3f1661d5-168a-fac7-66c7-c4d635df7d30","type":"NewModel","parameters":{"properties":"message_neodoctor,from","type-message_user":"string","type-message_neodoctor":"string","type-from":"string","prop-from":"doctor"},"ports":[],"children":[]},{"id":"157b7d29-e5d3-4e6f-fc31-2f0d3b623f58","type":"CollectionInsert","parameters":{},"ports":[],"children":[]},{"id":"96454fec-429e-6f56-4e0b-cabfe47de24c","type":"CollectionClear","parameters":{},"ports":[],"children":[]}],"connections":[{"sourceId":"cd801fc8-9f10-a6e2-4724-7e6faa0a25bc","sourcePort":"didMount","targetId":"e090976d-0067-3293-ea36-256c24003375","targetPort":"new"},{"sourceId":"22cebbed-ad51-efd9-b4fd-c19647f1668d","sourcePort":"id","targetId":"80488006-914a-87c4-3c45-2ca50a317d10","targetPort":"collectionId"},{"sourceId":"8b788aa8-b134-5b5d-619e-78a2698836e7","sourcePort":"id","targetId":"80488006-914a-87c4-3c45-2ca50a317d10","targetPort":"modifyId"},{"sourceId":"8b788aa8-b134-5b5d-619e-78a2698836e7","sourcePort":"created","targetId":"80488006-914a-87c4-3c45-2ca50a317d10","targetPort":"add"},{"sourceId":"6f255319-287e-109e-0dc2-6978cafa0e3f","sourcePort":"onTextChanged","targetId":"8b788aa8-b134-5b5d-619e-78a2698836e7","targetPort":"prop-message_user"},{"sourceId":"17514d1e-fc78-5481-6e75-3a7ad53c477a","sourcePort":"out-Response","targetId":"3f1661d5-168a-fac7-66c7-c4d635df7d30","targetPort":"prop-message_neodoctor"},{"sourceId":"17514d1e-fc78-5481-6e75-3a7ad53c477a","sourcePort":"out-Success","targetId":"3f1661d5-168a-fac7-66c7-c4d635df7d30","targetPort":"new"},{"sourceId":"3f1661d5-168a-fac7-66c7-c4d635df7d30","sourcePort":"id","targetId":"157b7d29-e5d3-4e6f-fc31-2f0d3b623f58","targetPort":"modifyId"},{"sourceId":"22cebbed-ad51-efd9-b4fd-c19647f1668d","sourcePort":"id","targetId":"157b7d29-e5d3-4e6f-fc31-2f0d3b623f58","targetPort":"collectionId"},{"sourceId":"3f1661d5-168a-fac7-66c7-c4d635df7d30","sourcePort":"created","targetId":"157b7d29-e5d3-4e6f-fc31-2f0d3b623f58","targetPort":"add"},{"sourceId":"2598754f-8bf9-932c-02b3-a922be43e025","sourcePort":"onClick","targetId":"17514d1e-fc78-5481-6e75-3a7ad53c477a","targetPort":"run"},{"sourceId":"2598754f-8bf9-932c-02b3-a922be43e025","sourcePort":"onClick","targetId":"8b788aa8-b134-5b5d-619e-78a2698836e7","targetPort":"new"},{"sourceId":"062dc9e0-0a95-60aa-8971-245f4b5e2dbe","sourcePort":"items","targetId":"7d83f801-da7e-5a96-138d-3e2aea5c8f04","targetPort":"in-data"},{"sourceId":"6f255319-287e-109e-0dc2-6978cafa0e3f","sourcePort":"onTextChanged","targetId":"7d83f801-da7e-5a96-138d-3e2aea5c8f04","targetPort":"in-message"},{"sourceId":"e090976d-0067-3293-ea36-256c24003375","sourcePort":"id","targetId":"7d83f801-da7e-5a96-138d-3e2aea5c8f04","targetPort":"in-id"},{"sourceId":"7d83f801-da7e-5a96-138d-3e2aea5c8f04","sourcePort":"out-Response","targetId":"17514d1e-fc78-5481-6e75-3a7ad53c477a","targetPort":"in-Data"},{"sourceId":"cd801fc8-9f10-a6e2-4724-7e6faa0a25bc","sourcePort":"didMount","targetId":"96454fec-429e-6f56-4e0b-cabfe47de24c","targetPort":"clear"},{"sourceId":"22cebbed-ad51-efd9-b4fd-c19647f1668d","sourcePort":"id","targetId":"96454fec-429e-6f56-4e0b-cabfe47de24c","targetPort":"collectionId"},{"sourceId":"17514d1e-fc78-5481-6e75-3a7ad53c477a","sourcePort":"out-Success","targetId":"6f255319-287e-109e-0dc2-6978cafa0e3f","targetPort":"clear"},{"sourceId":"22cebbed-ad51-efd9-b4fd-c19647f1668d","sourcePort":"items","targetId":"9c271320-dfc6-0dcc-de8c-999905c2aeeb","targetPort":"items"}],"ports":[],"roots":["cd801fc8-9f10-a6e2-4724-7e6faa0a25bc"]},{"name":"/Neodoctor/Chat message","nodes":[{"id":"d2572511-0060-7212-6676-f08e19176df5","type":"Group","parameters":{"sizeMode":"contentHeight","paddingLeft":{"value":12,"unit":"px"},"paddingRight":{"value":12,"unit":"px"},"paddingTop":{"value":12,"unit":"px"},"paddingBottom":{"value":12,"unit":"px"}},"ports":[],"children":[{"id":"4f9d5d70-9842-d437-e169-dd13f5dc8982","type":"Group","parameters":{"sizeMode":"contentSize","width":{"value":80,"unit":"%"},"maxWidth":{"value":80,"unit":"%"},"paddingLeft":{"value":8,"unit":"px"},"paddingRight":{"value":8,"unit":"px"},"paddingBottom":{"value":8,"unit":"px"},"paddingTop":{"value":8,"unit":"px"},"backgroundColor":"Grey - 200","boxShadowEnabled":true,"boxShadowOffsetX":{"value":-3,"unit":"px"},"boxShadowOffsetY":{"value":5,"unit":"px"}},"ports":[],"children":[{"id":"21c7be34-ceb7-3277-9475-76938474989f","type":"Text","parameters":{"text":"","sizeMode":"explicit"},"ports":[],"children":[]}]},{"id":"11b5b7ef-92d5-83e8-6c35-2cf9235ae4cf","type":"Group","parameters":{"width":{"value":80,"unit":"%"},"alignX":"right","sizeMode":"contentSize","maxWidth":{"value":80,"unit":"%"},"paddingLeft":{"value":8,"unit":"px"},"paddingRight":{"value":8,"unit":"px"},"paddingTop":{"value":8,"unit":"px"},"paddingBottom":{"value":8,"unit":"px"},"backgroundColor":"Grey - 200","boxShadowEnabled":true,"boxShadowOffsetY":{"value":5,"unit":"px"},"boxShadowOffsetX":{"value":3,"unit":"px"}},"ports":[],"children":[{"id":"14f18322-0309-1313-cf5c-f9292d4a3b13","type":"Text","parameters":{"text":"","sizeMode":"explicit"},"ports":[],"children":[]}]}]},{"id":"46f9da76-6972-fa2e-50ef-013b806a1706","type":"Model2","parameters":{"idSource":"foreach","properties":"from,message_user,message_neodoctor"},"ports":[],"children":[]},{"id":"762f2a6c-c71e-2c83-d889-c7a96d98406e","type":"States","parameters":{"states":"user,doctor","type-user":"boolean","type-doctor":"boolean","type-mount":"boolean","useTransitions":false,"value-user-mount":true},"ports":[],"children":[]}],"connections":[{"sourceId":"46f9da76-6972-fa2e-50ef-013b806a1706","sourcePort":"prop-from","targetId":"762f2a6c-c71e-2c83-d889-c7a96d98406e","targetPort":"currentState"},{"sourceId":"46f9da76-6972-fa2e-50ef-013b806a1706","sourcePort":"prop-message_user","targetId":"21c7be34-ceb7-3277-9475-76938474989f","targetPort":"text"},{"sourceId":"46f9da76-6972-fa2e-50ef-013b806a1706","sourcePort":"prop-message_neodoctor","targetId":"14f18322-0309-1313-cf5c-f9292d4a3b13","targetPort":"text"},{"sourceId":"762f2a6c-c71e-2c83-d889-c7a96d98406e","sourcePort":"at-user","targetId":"4f9d5d70-9842-d437-e169-dd13f5dc8982","targetPort":"mounted"},{"sourceId":"762f2a6c-c71e-2c83-d889-c7a96d98406e","sourcePort":"at-doctor","targetId":"11b5b7ef-92d5-83e8-6c35-2cf9235ae4cf","targetPort":"mounted"}],"ports":[],"roots":["d2572511-0060-7212-6676-f08e19176df5"]}]